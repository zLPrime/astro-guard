"""
Astronomical Object Classification Pipeline

A hierarchical ML pipeline combining time series CNN features and statistical features
for two-level classification of celestial objects.

Pipeline Stages:
1. Data Preparation:
   - Standard scaling of FATS features (magnitude statistics)
   - Time series processing for CNN (normalization, padding to 500 points)
   - Label encoding for hierarchical classes

2. CNN Model (Supervised Learning):
   - Architecture: 1D Conv layers + Global Max Pooling
   - Output: 256-dim embeddings + main class predictions
   - Training: 50 epochs with early stopping, class-weighted loss

3. Feature Fusion:
   - Combines FATS features (X_fats) and CNN embeddings (X_ts_emb)
   - Creates unified feature space (X_combined)

4. Hierarchical Classification:
   - Level 1 (Main Classes): LightGBM model trained on combined features
   - Level 2 (Subclasses): Per-class LightGBM models trained on samples from corresponding main class
   - Threshold-based fallback to 'OTHER' class at both levels

5. Evaluation:
   - Custom hierarchical metrics reporting
   - Confidence-based prediction filtering (threshold=0.7)

Key Parameters:
- Temporal Features: 500 time points, 2 channels (mag, mag_err)
- CNN Architecture: [64, 128] filters, kernel_size=[5, 3]
- LGBM Main: 64 leaves, 300 trees, 0.05 learning rate
- LGBM Sub: 32 leaves, 200 trees, 0.1 learning rate

Input Requirements:
- features_df: DataFrame with FATS features + object_id
- cnn_arrays: Time series data with columns ['mag', 'mag_err']
- balanced_labels: DataFrame with ['main_class', 'variability_type']

Outputs:
- Trained CNN model (time series feature extractor)
- Hierarchical LGBM models (main + per-class submodels)
- Evaluation reports for both classification levels

Dependencies:
- TensorFlow/Keras (CNN)
- LightGBM (hierarchical classifiers)
- Scikit-learn (preprocessing, metrics)
- NumPy/Pandas (data manipulation)

Note:
- Implements class balancing through weighting
- Uses 80/20 stratified split for validation
- Embeds domain-specific logic for astronomical data
- Requires matching label encoders between training/inference
"""